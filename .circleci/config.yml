version: 2.1

orbs:
  python: circleci/python@2.1.1

default_python_version: &default_python_version "3.10"
matrix_python_versions: &matrix_python_versions
  matrix:
    parameters:
      python_version: ["3.10", "3.11"]

jobs:
  run_lint:
    executor:
      name: python/default
      tag: *default_python_version
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: poetry
      - run:
          name: Lint, but ‚ö†Ô∏è failures are ignored at the moment
          command: |
            make lint || \
            ( printf "\n üôà We're ignoring this failure until we have our rules sorted. ·ïï( ·êõ )·ïó \n\n" ; true )
  run_codestyle:
    executor:
      name: python/default
      tag: *default_python_version
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: poetry
      - run: make style
  run_tests:
    parameters:
      python_version:
        type: string
        default: *default_python_version
    executor:
      name: python/default
      tag: "<< parameters.python_version >>"
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: poetry
      - run: make test
      - store_test_results:
          path: test-results

workflows:
  build:
    jobs:
      - run_lint
      - run_codestyle
      - run_tests:
          <<: *matrix_python_versions
