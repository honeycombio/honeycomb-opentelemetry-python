version: 2.1

orbs:
  python: circleci/python@2.1.1

default_python_version: &default_python_version "3.10"
matrix_python_versions: &matrix_python_versions
  matrix:
    parameters:
      python_version: ["3.10", "3.11"]

jobs:
  # lint:
  #   executor:
  #     name: python/default
  #     tag: *default_python_version
  #   steps:
  #     - checkout
  #     - python/install-packages:
  #         pkg-manager: poetry
  #     - run: make lint
  codestyle:
    executor:
      name: python/default
      tag: *default_python_version
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: poetry
      - run: make style
  test:
    parameters:
      python_version:
        type: string
        default: *default_python_version
    executor:
      name: python/default
      tag: "<< parameters.python_version >>"
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: poetry
      - run: make test
      - store_test_results:
          path: test-results

workflows:
  build:
    jobs:
      # - lint # We need to get our rules in order.
      - codestyle
      - test:
          <<: *matrix_python_versions
